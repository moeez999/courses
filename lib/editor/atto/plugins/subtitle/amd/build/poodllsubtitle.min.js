define ("atto_subtitle/poodllsubtitle",["jquery","atto_subtitle/constants","atto_subtitle/vtthelper","atto_subtitle/subtitleset","atto_subtitle/previewhelper","atto_subtitle/playerhelper","core/templates","atto_subtitle/dlg_actions"],function(a,b,c,d,e,f,g,h){return{controls:{},currentindex:!1,currentitemcontainer:null,editoropen:!1,init:function init(a,b){d.init(a);e.init(d,b);f.init(b);this.initControls();this.initDialog();this.initTiles();this.initEvents()},initControls:function initControls(){this.controls.container=a("#poodllsubtitle_tiles");this.controls.editor=a("#poodllsubtitle_editor");this.controls.number=a("#poodllsubtitle_editor .numb_song");this.controls.edstart=a("#poodllsubtitle_edstart");this.controls.edend=a("#poodllsubtitle_edend");this.controls.edpart=a("#poodllsubtitle_edpart");this.controls.buttondelete=a("#poodllsubtitle_eddelete");this.controls.buttonmergeup=a("#poodllsubtitle_edmergeup");this.controls.buttonsplit=a("#poodllsubtitle_edsplit");this.controls.buttonapply=a("#poodllsubtitle_edapply");this.controls.buttoncancel=a("#poodllsubtitle_edcancel");this.controls.buttonaddnew=a("#poodllsubtitle_addnew");this.controls.buttonstartsetnow=a("#poodllsubtitle_startsetnow");this.controls.buttonendsetnow=a("#poodllsubtitle_endsetnow");this.controls.buttonstartbumpup=a("#poodllsubtitle_startbumpup");this.controls.buttonstartbumpdown=a("#poodllsubtitle_startbumpdown");this.controls.buttonendbumpup=a("#poodllsubtitle_endbumpup");this.controls.buttonendbumpdown=a("#poodllsubtitle_endbumpdown");this.controls.buttonactions=a(b.actionsbutton);this.controls.actionsdialog=a("#poodllsubtitle_dialogue_box_actions")},initDialog:function initDialog(){var a=this;h.set_dialogue_box(this.controls.actionsdialog);g.render("atto_subtitle/subtitleexportimport",{}).then(function(b){h.setContent(b,a)})},hideEditor:function hideEditor(){this.controls.editor.detach();this.controls.editor.hide();this.editoropen=!1},restoreTile:function restoreTile(){var a=d.fetchItem(this.currentindex),b=this;this.fetchNewTextTile(this.currentindex,a.start,a.end,a.part,function onend(a){b.hideEditor();b.currentitemcontainer.append(a)})},editorToTile:function editorToTile(b,e,f,g){var h=c.timeString2ms(a(b.edstart).val()),i=c.timeString2ms(a(b.edend).val()),j=this.validateTimes(e,h,i);if(!j){a(f).addClass("warning");return!1}var k=a(b.edpart).val();d.updateItem(e,h,i,k);var l=this;this.fetchNewTextTile(e,h,i,k,function on_fetch_finish(b){l.hideEditor();f.append(b);a(f).removeClass("warning");if(g){g()}});return!0},initEvents:function initEvents(){var f=this;this.controls.container.on("click",".poodllsubtitle_tt",function(){var b=parseInt(a(this).parent().attr("data-id")),c=a(this).parent(),d=function(){f.currentindex=b;f.currentitemcontainer=c;f.shiftEditor(f.currentindex,f.currentitemcontainer);e.setPosition(f.currentindex)};if(!0===f.editoropen){f.editorToTile(f.controls,f.currentindex,f.currentitemcontainer,d)}else{d()}});this.controls.container.on("click",b.C_BUTTONDELETE,function(){result=confirm("Warning! This tile is going to be deleted!");if(result){var a=d.fetchItem(f.currentindex),b=function(a){f.hideEditor();f.currentitemcontainer.append(a);d.removeItem(f.currentindex);f.syncFrom(f.currentindex);e.updateLabel()};f.fetchNewTextTile(f.currentindex,a.start,a.end,a.part,b)}else{}});this.controls.container.on("click",b.C_BUTTONMERGEUP,function(){f.editorToTile(f.controls,f.currentindex,f.currentitemcontainer,function onend(){d.mergeUp(f.currentindex);f.syncFrom(f.currentindex-1);e.setPosition(f.currentindex-1)})});this.controls.container.on("click",b.C_BUTTONSPLIT,function(){f.editorToTile(f.controls,f.currentindex,f.currentitemcontainer,function onend(){d.split(f.currentindex);f.syncFrom(f.currentindex);e.updateLabel()})});this.controls.container.on("click",b.C_BUTTONAPPLY,function(){f.editorToTile(f.controls,f.currentindex,f.currentitemcontainer,function onend(){e.updateLabel()})});this.controls.container.on("click",b.C_BUTTONCANCEL,function(){f.restoreTile()});this.controls.container.on("click",b.C_BUTTONSTARTSETNOW,function(){var a=e.fetchCurrentTime(),b=c.ms2TimeString(a);f.controls.edstart.val(b)});this.controls.container.on("click",b.C_BUTTONENDSETNOW,function(){var a=e.fetchCurrentTime(),b=c.ms2TimeString(a);f.controls.edend.val(b)});this.controls.container.on("click",b.C_BUTTONSTARTBUMPUP,function(){f.doBump(f.controls.edstart,b.bumpinterval)});this.controls.container.on("click",b.C_BUTTONSTARTBUMPDOWN,function(){f.doBump(f.controls.edstart,-1*b.bumpinterval)});this.controls.container.on("click",b.C_BUTTONENDBUMPUP,function(){f.doBump(f.controls.edend,b.bumpinterval)});this.controls.container.on("click",b.C_BUTTONENDBUMPDOWN,function(){f.doBump(f.controls.edend,-1*b.bumpinterval)});this.controls.edstart.keypress(function(a){var b=a.keyCode?a.keyCode:a.which;if(!(48<=b&&57>=b||58==b||46==b))a.preventDefault()});this.controls.buttonaddnew.click(function(){var a=d.fetchCount(),b=a,c=0;if(0<a){var e=d.fetchItem(a-1);c=e.end+500}var g=c+2e3;d.addItem(b,c,g,"");f.fetchNewTextTileContainer(b,c,g,"",function onend(a){f.controls.container.append(a)})});this.controls.buttonactions.click(function(){h.open()});e.highlightItem=this.highlightContainer;e.deHighlightAll=this.deHighlightAll},doBump:function doBump(a,b){var d=a.val();if(!c.validateTimeString(d)){return}var e=c.timeString2ms(d);e+=b;if(0>e){e=0}d=c.ms2TimeString(e);a.val(d)},initTiles:function initTiles(){var a=this.controls.container,b=this,c=d.fetchCount();this.fetchNewTextTile(0,0,0,"",function reallyInitTiles(){if(0<c){for(var e=0;e<c;e++){var f=d.fetchItem(e),g=function(b){a.append(b)},h=b.fetchNewTextTileContainer(e,f.start,f.end,f.part,g)}}})},validateTimes:function validateTimes(a,b,c){if(c<=b){return!1}var e=!1,f=!1;if(0<a){e=d.fetchItem(a-1)}if(a<d.fetchCount()-1){f=d.fetchItem(a+1)}if(e&&e.end>b){return!1}if(f&&f.start<c){return!1}return!0},shiftEditor:function shiftEditor(b,e){this.controls.editor.hide();var f=d.fetchItem(b),g=c.ms2TimeString(f.start);a(this.controls.edstart).val(g);var h=c.ms2TimeString(f.end);a(this.controls.edend).val(h);var i=f.part;a(this.controls.edpart).val(i);e.empty();e.append(this.controls.editor);this.controls.editor.show();this.editoropen=!0;a(this.controls.number).text(b+1)},fetchNewTextTile:function fetchNewTextTile(a,b,d,e,f){var h=[];h.imgpath=M.cfg.wwwroot+"/lib/editor/atto/plugins/subtitle/pix/e/";h.start=c.ms2TimeString(b);h.end=c.ms2TimeString(d);h.dataid=a+1;h.part=e;g.render("atto_subtitle/subtitletile",h).then(function(a){f(a)})},fetchNewTextTileContainer:function fetchNewTextTileContainer(a,b,d,e,f){var h=[];h.imgpath=M.cfg.wwwroot+"/lib/editor/atto/plugins/subtitle/pix/e/";h.start=c.ms2TimeString(b);h.end=c.ms2TimeString(d);h.outerdataid=a;h.dataid=a+1;h.part=e;g.render("atto_subtitle/subtitletilecontainer",h).then(function(a){f(a)})},clearTiles:function clearTiles(){this.controls.container.empty()},resetData:function resetData(a){this.hideEditor();this.clearTiles();d.init(a);this.initTiles()},syncFrom:function syncFrom(b){for(var c=d.fetchCount(),e=this,f=b;f<c;f++){var g=d.fetchItem(f),h=a(".poodllsubtitle_itemcontainer").filter(function(){return parseInt(a(this).attr("data-id"))==f});if(0<h.length){this.updateTextTile(h,g)}else{var i=function(a){e.controls.container.append(a)},j=this.fetchNewTextTileContainer(f,g.start,g.end,g.part,i)}}a(".poodllsubtitle_itemcontainer").filter(function(){return parseInt(a(this).attr("data-id"))>=c}).remove()},syncAt:function syncAt(){},updateTextTile:function updateTextTile(b,d){var e=c.ms2TimeString(d.start),f=c.ms2TimeString(d.end);a(b).find(".poodllsubtitle_tt_start").text(e);a(b).find(".poodllsubtitle_tt_end").text(f);a(b).find(".poodllsubtitle_tt_part").text(d.part);a(b).find(".poodllsubtitle_tt_start").val(e);a(b).find(".poodllsubtitle_tt_end").val(f);a(b).find(".poodllsubtitle_tt_part").text(d.part)},highlightContainer:function highlightContainer(b){this.deHighlightAll();var c=a(".poodllsubtitle_itemcontainer").filter(function(){return parseInt(a(this).attr("data-id"))==b});c.addClass("activesubtitle")},deHighlightAll:function deHighlightAll(){a(".poodllsubtitle_itemcontainer").removeClass("activesubtitle")},fetchSubtitleData:function fetchSubtitleData(){return d.fetchSubtitleData()}}});
//# sourceMappingURL=poodllsubtitle.min.js.map
