define(["jquery","core/ajax","core/templates"],function(a,b,c){var d={init:function(){a("select#id_groupid").on("change",d.groupChanged),d.lastSelectedGroup=a("select#id_groupid").val(),d.courseid=a("input:hidden[name=course]").val(),d.instanceid=a("input:hidden[name=instance-id]").val(),d.userwarning=a(".manual-issue-warning"),d.manualuserscontainer=a("#manual-issue-users-container"),d.unissuedusers=a("#id_chooseunissuedusers"),d.unissuedusersmessage=a("#fitem_id_unissueddescription"),d.selectallbutton=a("#fitem_id_nosubmit_checkbox_controller1, #fitem_id_nosubmit_checkbox_controller2"),""===d.lastSelectedGroup&&(d.userwarning.removeClass("hidden"),d.manualuserscontainer.addClass("hidden")),0==a("#unissued-users-container .form-group").length&&d.unissuedusers.hide().addClass("collapsed")},groupChanged:function(){a("select#id_groupid").val()!==d.lastSelectedGroup&&(d.lastSelectedGroup=a("select#id_groupid").val(),""===d.lastSelectedGroup?d.displayNoUsersWarning():(b.call([{methodname:"mod_accredible_reload_users",args:{courseid:d.courseid,groupid:a("select#id_groupid").val(),instanceid:d.instanceid}}])[0].done(d.updateUsers),d.userwarning.addClass("hidden"),d.manualuserscontainer.removeClass("hidden"),d.unissuedusersmessage.removeClass("hidden"),d.selectallbutton.removeClass("hidden")))},displayNoUsersWarning:function(){a("#manual-issue-users-container .form-group, #unissued-users-container .form-group").remove(),d.userwarning.removeClass("hidden"),d.selectallbutton.addClass("hidden"),d.manualuserscontainer.addClass("hidden"),d.unissuedusersmessage.addClass("hidden"),d.unissuedusers.show()},updateUsers:function(b){var c;a("#manual-issue-users-container .form-group, #unissued-users-container .form-group").remove(),a(b.users).each(function(a,b){c=b.credential_url?{element:{html:"Certificate "+b.credential_id+" - <a href="+b.credential_url+' target="_blank">link</a>',staticlabel:!0},label:b.name+"   "+b.email}:{element:{id:"id_users_"+b.id,name:"users["+b.id+"]",extraclasses:"checkboxgroup1",selectedvalue:1},label:b.name+"   "+b.email},d.renderUser(c,"#manual-issue-users-container",b.credential_url)}),b.unissued_users.length>0?(d.unissuedusers.show(),a(b.unissued_users).each(function(a,b){c={element:{id:"id_unissuedusers_"+b.id,name:"unissuedusers["+b.id+"]",extraclasses:"checkboxgroup2",selectedvalue:1},label:b.name+"   "+b.email},d.renderUser(c,"#unissued-users-container",null)})):d.unissuedusers.hide().addClass("collapsed")},renderUser:function(a,b,d){var e=d?"core_form/element-static":"core_form/element-advcheckbox";c.renderForPromise(e,a).then(function(a){c.appendNodeContents(b,a.html,a.js)})}};return d});