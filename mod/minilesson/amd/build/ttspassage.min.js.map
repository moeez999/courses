{"version":3,"file":"ttspassage.min.js","sources":["../src/ttspassage.js"],"sourcesContent":["define(['jquery','core/log'], function($,log) {\n    \"use strict\"; // jshint ;_;\n\n\n    log.debug('MiniLesson TTS Passage: initialising');\n\n    return{\n\n        init: function(PASSAGEID){\n\n            //DECLARATIONS and INITs ...........................\n            var thesentence_number =0;\n            var lettered= false;\n            var stoporpause='stop';\n\n\n\n            //audio player declarations\n            var aplayer = $('#' + PASSAGEID + '_player');\n            var fa = $('#' + PASSAGEID + ' .fa');\n\n            //some common selectors\n            var sentenceselector = '#' + PASSAGEID+ '_textblock span.tbr_sentence';\n            var passagelines = $(sentenceselector);\n\n            var numberSentences = function(){\n                var linecount = passagelines.length;\n                for (var thesentence=0; thesentence < linecount; thesentence++){\n                    $(passagelines[thesentence]).attr('data-sentenceindex',thesentence);\n                }//end of for loop\n            };\n\n            //FUNCTION:  unhighlight a sentence as active\n            var dehighlight_all = function(){\n                passagelines.removeClass('passageplayer_activesentence');\n            };\n\n            //FUNCTION:  highlight a sentence as active\n            var highlight_sentence = function(thesentence){\n                passagelines.removeClass('passageplayer_activesentence');\n                $(passagelines[thesentence]).addClass('passageplayer_activesentence');\n                // $(sentenceselector + '[data-sentenceindex=' + thesentence + ']').addClass('passageplayer_activesentence');\n            };\n\n            //FUNCTION: play a single sentence and mark it active for display purposes\n            var doplayaudio = function(thesentence){\n                log.debug(thesentence);\n                log.debug($(passagelines[thesentence]).data('audiourl'));\n                highlight_sentence(thesentence);\n                aplayer.attr('src',$(passagelines[thesentence]).data('audiourl'));\n                aplayer[0].play();\n            };\n\n\n            //AUDIO PLAYER events\n            aplayer[0].addEventListener('ended', function(){\n                if(thesentence_number< passagelines.length -1){\n                    thesentence_number++;\n                    doplayaudio(thesentence_number);\n                }else{\n                    dehighlight_all();\n                    $(fa).removeClass('fa-stop');\n                    $(fa).addClass('fa-volume-up');\n                    thesentence_number=0;\n                    aplayer.removeAttr('src');\n                }\n            });\n\n            //handle audio player button clicks\n            $('#' + PASSAGEID).click(function(){\n                if(!aplayer[0].paused && !aplayer[0].ended){\n                    aplayer[0].pause();\n                    if(stoporpause=='stop'){\n                        aplayer[0].load();\n                        thesentence_number=0;\n                    }\n                    $(fa).removeClass('fa-stop');\n                    $(fa).addClass('fa-volume-up');\n\n                    //if paused and in limbo no src state\n                }else if(aplayer[0].paused && aplayer.attr('src')){\n                    aplayer[0].play();\n                    $(fa).removeClass('fa-volume-up');\n                    $(fa).addClass('fa-stop');\n                    //play\n                }else{\n                    if(!lettered){\n                        //spanify_text_passage();\n                        lettered=true;\n                    }//end of if lettered\n                    if(stoporpause=='stop'){\n                        thesentence_number=0;\n                    }\n                    doplayaudio(thesentence_number);\n                    $(fa).removeClass('fa-volume-up');\n                    $(fa).addClass('fa-stop');\n                }//end of if paused ended\n            });\n\n            //handle sentence clicks\n            $('#' + PASSAGEID + '_textblock  .tbr_innerdiv').on('click', '.tbr_sentence',function(){\n                aplayer[0].pause();\n                var sentenceindex = $(this).attr('data-sentenceindex');\n                $(fa).removeClass('fa-volume-up');\n                $(fa).addClass('fa-stop');\n                thesentence_number = sentenceindex;\n                doplayaudio(sentenceindex);\n            });\n\n            //PROCEDURAL stuff\n            numberSentences();\n\n            //end of instance wrapper\n        }\n\n    };//end of return value\n});"],"names":["define","$","log","debug","init","PASSAGEID","thesentence_number","lettered","aplayer","fa","passagelines","doplayaudio","thesentence","data","removeClass","addClass","highlight_sentence","attr","play","addEventListener","length","removeAttr","click","paused","ended","pause","load","on","sentenceindex","this","linecount","numberSentences"],"mappings":"AAAAA,mCAAO,CAAC,SAAS,aAAa,SAASC,EAAEC,YAIrCA,IAAIC,MAAM,wCAEJ,CAEFC,KAAM,SAASC,eAGPC,mBAAoB,EACpBC,UAAU,EAMVC,QAAUP,EAAE,IAAMI,UAAY,WAC9BI,GAAKR,EAAE,IAAMI,UAAY,QAIzBK,aAAeT,EADI,IAAMI,UAAW,gCAuBpCM,YAAc,SAASC,aACvBV,IAAIC,MAAMS,aACVV,IAAIC,MAAMF,EAAES,aAAaE,cAAcC,KAAK,aATvB,SAASD,aAC9BF,aAAaI,YAAY,gCACzBb,EAAES,aAAaE,cAAcG,SAAS,gCAQtCC,CAAmBJ,aACnBJ,QAAQS,KAAK,MAAMhB,EAAES,aAAaE,cAAcC,KAAK,aACrDL,QAAQ,GAAGU,QAKfV,QAAQ,GAAGW,iBAAiB,SAAS,WAC9Bb,mBAAoBI,aAAaU,OAAQ,GACxCd,qBACAK,YAAYL,sBAxBhBI,aAAaI,YAAY,gCA2BrBb,EAAEQ,IAAIK,YAAY,WAClBb,EAAEQ,IAAIM,SAAS,gBACfT,mBAAmB,EACnBE,QAAQa,WAAW,WAK3BpB,EAAE,IAAMI,WAAWiB,OAAM,WACjBd,QAAQ,GAAGe,QAAWf,QAAQ,GAAGgB,MAU5BhB,QAAQ,GAAGe,QAAUf,QAAQS,KAAK,QACvCT,QAAQ,GAAGU,OACXjB,EAAEQ,IAAIK,YAAY,gBAClBb,EAAEQ,IAAIM,SAAS,aAGXR,WAEAA,UAAS,GAKbI,YAFIL,mBAAmB,GAGvBL,EAAEQ,IAAIK,YAAY,gBAClBb,EAAEQ,IAAIM,SAAS,aAxBfP,QAAQ,GAAGiB,QAEPjB,QAAQ,GAAGkB,OACXpB,mBAAmB,EAEvBL,EAAEQ,IAAIK,YAAY,WAClBb,EAAEQ,IAAIM,SAAS,oBAuBvBd,EAAE,IAAMI,UAAY,6BAA6BsB,GAAG,QAAS,iBAAgB,WACzEnB,QAAQ,GAAGiB,YACPG,cAAgB3B,EAAE4B,MAAMZ,KAAK,sBACjChB,EAAEQ,IAAIK,YAAY,gBAClBb,EAAEQ,IAAIM,SAAS,WACfT,mBAAqBsB,cACrBjB,YAAYiB,kBAjFM,mBACdE,UAAYpB,aAAaU,OACpBR,YAAY,EAAGA,YAAckB,UAAWlB,cAC7CX,EAAES,aAAaE,cAAcK,KAAK,qBAAqBL,aAkF/DmB"}