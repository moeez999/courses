{"version":3,"file":"submissionhelper.min.js","sources":["../src/submissionhelper.js"],"sourcesContent":["define(['jquery','core/log','assignsubmission_cloudpoodll/cloudpoodllloader',\"core/str\"], function($,log,cloudpoodll,str) {\n    \"use strict\"; // jshint ;_;\n\n    log.debug('submission helper: initialising');\n\n    return {\n\n        uploadstate: false,\n        togglestate: 0,\n        strings: {},\n\n\n        init:  function(opts) {\n            this.component = opts['component'];\n            this.safesave=opts['safesave'];\n\n            this.register_controls();\n            this.register_events();\n            this.setup_recorder();\n        },\n\n        setup_recorder: function(){\n            var that = this;\n            var recorder_callback = function(evt){\n                switch(evt.type){\n                    case 'recording':\n                        if(evt.action==='started'){\n                            that.controls.updatecontrol.val();\n                            //if opts safe save\n                            if(that.safesave==1) {\n                                that.controls.formsubmitbutton.attr('disabled', 'disabled');\n                            }\n                        }\n                        break;\n                    case 'awaitingprocessing':\n                        if(that.uploadstate!='posted') {\n                            that.controls.updatecontrol.val(evt.mediaurl);\n                            //if opts safe save\n                            if(that.safesave==1) {\n                                that.controls.formsubmitbutton.removeAttr('disabled', 'disabled');\n                            }\n                        }\n                        that.uploadstate='posted';\n                        break;\n                    case 'error':\n                        alert('PROBLEM:' + evt.message);\n                        break;\n                }\n            };\n            cloudpoodll.init(this.component + '_therecorder',recorder_callback);\n        },\n\n\n        register_controls: function(){\n          var that=this;\n          this.controls={};\n          this.controls.formsubmitbutton = $('#id_submitbutton');\n          this.controls.deletebutton = $('.' + this.component + '_deletesubmissionbutton');\n          this.controls.updatecontrol =  $('#' + this.component + '_updatecontrol');\n          this.controls.currentcontainer =  $('.' + this.component + '_currentsubmission');\n          this.controls.togglecontainer =  $('.' + this.component + '_togglecontainer');\n          this.controls.togglebutton =  $('.' + this.component + '_togglecontainer .togglebutton');\n          this.controls.toggletext =  $('.' + this.component + '_togglecontainer .toggletext');\n            str.get_string('clicktohide',that.component).done(function(s) {\n                that.strings['clicktohide']=s;\n            });\n            str.get_string('clicktoshow',that.component).done(function(s) {\n                that.strings['clicktoshow']=s;\n            });\n        },\n\n        register_events: function(){\n            var that =this;\n            this.controls.deletebutton.click(function(){\n                if(that.controls.updatecontrol){\n                    if(confirm(M.util.get_string('reallydeletesubmission',that.component))){\n                        that.controls.updatecontrol.val(-1);\n                        that.controls.currentcontainer.html('');\n                    }\n                }\n            });\n            this.controls.togglebutton.click(function(){that.toggle_currentsubmission(that);});\n            this.controls.toggletext.click(function(){that.toggle_currentsubmission(that);});\n        },\n\n        toggle_currentsubmission: function(that){\n            var doToggleState = function(){\n                if(that.togglestate==0){\n                    that.controls.togglebutton.removeClass('fa-toggle-off');\n                    that.controls.togglebutton.addClass('fa-toggle-on');\n                    that.controls.toggletext.text(that.strings['clicktohide']);\n                    that.togglestate=1;\n                }else{\n                    that.controls.togglebutton.removeClass('fa-toggle-on');\n                    that.controls.togglebutton.addClass('fa-toggle-off');\n                    that.controls.toggletext.text(that.strings['clicktoshow']);\n                    that.togglestate=0;\n                }\n            };\n            that.controls.currentcontainer.toggle(\n                {duration: 300, complete: doToggleState}\n            );\n            return false;\n        }\n    };//end of return object\n});"],"names":["define","$","log","cloudpoodll","str","debug","uploadstate","togglestate","strings","init","opts","component","safesave","register_controls","register_events","setup_recorder","that","this","evt","type","action","controls","updatecontrol","val","formsubmitbutton","attr","mediaurl","removeAttr","alert","message","deletebutton","currentcontainer","togglecontainer","togglebutton","toggletext","get_string","done","s","click","confirm","M","util","html","toggle_currentsubmission","toggle","duration","complete","removeClass","addClass","text"],"mappings":"AAAAA,uDAAO,CAAC,SAAS,WAAW,iDAAiD,aAAa,SAASC,EAAEC,IAAIC,YAAYC,YAGjHF,IAAIG,MAAM,mCAEH,CAEHC,aAAa,EACbC,YAAa,EACbC,QAAS,GAGTC,KAAO,SAASC,WACPC,UAAYD,KAAI,eAChBE,SAASF,KAAI,cAEbG,yBACAC,uBACAC,kBAGTA,eAAgB,eACRC,KAAOC,KA2BXd,YAAYM,KAAKQ,KAAKN,UAAY,gBA1BV,SAASO,YACtBA,IAAIC,UACF,YACe,YAAbD,IAAIE,SACHJ,KAAKK,SAASC,cAAcC,MAEV,GAAfP,KAAKJ,UACJI,KAAKK,SAASG,iBAAiBC,KAAK,WAAY,uBAIvD,qBACoB,UAAlBT,KAAKV,cACJU,KAAKK,SAASC,cAAcC,IAAIL,IAAIQ,UAElB,GAAfV,KAAKJ,UACJI,KAAKK,SAASG,iBAAiBG,WAAW,WAAY,aAG9DX,KAAKV,YAAY,mBAEhB,QACDsB,MAAM,WAAaV,IAAIW,cAQvChB,kBAAmB,eACbG,KAAKC,UACJI,SAAS,QACTA,SAASG,iBAAmBvB,EAAE,yBAC9BoB,SAASS,aAAe7B,EAAE,IAAMgB,KAAKN,UAAY,gCACjDU,SAASC,cAAiBrB,EAAE,IAAMgB,KAAKN,UAAY,uBACnDU,SAASU,iBAAoB9B,EAAE,IAAMgB,KAAKN,UAAY,2BACtDU,SAASW,gBAAmB/B,EAAE,IAAMgB,KAAKN,UAAY,yBACrDU,SAASY,aAAgBhC,EAAE,IAAMgB,KAAKN,UAAY,uCAClDU,SAASa,WAAcjC,EAAE,IAAMgB,KAAKN,UAAY,gCACnDP,IAAI+B,WAAW,cAAcnB,KAAKL,WAAWyB,MAAK,SAASC,GACvDrB,KAAKR,QAAL,YAA4B6B,KAEhCjC,IAAI+B,WAAW,cAAcnB,KAAKL,WAAWyB,MAAK,SAASC,GACvDrB,KAAKR,QAAL,YAA4B6B,MAIpCvB,gBAAiB,eACTE,KAAMC,UACLI,SAASS,aAAaQ,OAAM,WAC1BtB,KAAKK,SAASC,eACViB,QAAQC,EAAEC,KAAKN,WAAW,yBAAyBnB,KAAKL,cACvDK,KAAKK,SAASC,cAAcC,KAAK,GACjCP,KAAKK,SAASU,iBAAiBW,KAAK,aAI3CrB,SAASY,aAAaK,OAAM,WAAWtB,KAAK2B,yBAAyB3B,cACrEK,SAASa,WAAWI,OAAM,WAAWtB,KAAK2B,yBAAyB3B,UAG5E2B,yBAA0B,SAAS3B,aAc/BA,KAAKK,SAASU,iBAAiBa,OAC3B,CAACC,SAAU,IAAKC,SAdA,WACK,GAAlB9B,KAAKT,aACJS,KAAKK,SAASY,aAAac,YAAY,iBACvC/B,KAAKK,SAASY,aAAae,SAAS,gBACpChC,KAAKK,SAASa,WAAWe,KAAKjC,KAAKR,QAAL,aAC9BQ,KAAKT,YAAY,IAEjBS,KAAKK,SAASY,aAAac,YAAY,gBACvC/B,KAAKK,SAASY,aAAae,SAAS,iBACpChC,KAAKK,SAASa,WAAWe,KAAKjC,KAAKR,QAAL,aAC9BQ,KAAKT,YAAY,OAMlB"}